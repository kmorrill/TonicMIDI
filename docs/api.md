<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

*   [DrumPattern][1]
    *   [Parameters][2]
    *   [\_inferLowAndHighPatterns][3]
        *   [Parameters][4]
    *   [getNotes][5]
        *   [Parameters][6]
    *   [getLength][7]
    *   [setHypeLevel][8]
        *   [Parameters][9]
*   [SyncopatedBass][10]
    *   [Parameters][11]
    *   [getNotes][12]
        *   [Parameters][13]
    *   [selectNoteByProbability][14]
        *   [Parameters][15]
    *   [getLength][16]
*   [ExplicitNotePattern][17]
    *   [Parameters][18]
    *   [getNotes][19]
        *   [Parameters][20]
    *   [getLength][21]
*   [LFO][22]
    *   [Parameters][23]
    *   [update][24]
        *   [Parameters][25]
    *   [updateContinuousTime][26]
        *   [Parameters][27]
    *   [\_computeWaveValue][28]
        *   [Parameters][29]
    *   [reset][30]
        *   [Parameters][31]
    *   [setFrequency][32]
        *   [Parameters][33]
    *   [getFrequency][34]
    *   [setAmplitude][35]
        *   [Parameters][36]
    *   [getAmplitude][37]
    *   [setOffset][38]
        *   [Parameters][39]
    *   [getOffset][40]
    *   [setShape][41]
        *   [Parameters][42]
    *   [getShape][43]
    *   [setPhase][44]
        *   [Parameters][45]
    *   [getPhase][46]
    *   [setUseRadians][47]
        *   [Parameters][48]
    *   [getUseRadians][49]
    *   [setTargetParam][50]
        *   [Parameters][51]
    *   [getTargetParam][52]
    *   [setMinCcValue][53]
        *   [Parameters][54]
    *   [getMinCcValue][55]
    *   [setMaxCcValue][56]
        *   [Parameters][57]
    *   [getMaxCcValue][58]
*   [EnergyManager][59]
    *   [Parameters][60]
    *   [setHypeLevel][61]
        *   [Parameters][62]
    *   [setTensionLevel][63]
        *   [Parameters][64]
    *   [addLiveLoop][65]
        *   [Parameters][66]
    *   [removeLiveLoop][67]
        *   [Parameters][68]
    *   [setArrangementStyle][69]
        *   [Parameters][70]
    *   [setChordProgression][71]
        *   [Parameters][72]
*   [LiveLoop][73]
    *   [Parameters][74]
    *   [tick][75]
        *   [Parameters][76]
    *   [updateLFOsOnly][77]
        *   [Parameters][78]
    *   [\_applyQueuedChangesIfNeeded][79]
        *   [Parameters][80]
    *   [setPattern][81]
        *   [Parameters][82]
    *   [addLFO][83]
        *   [Parameters][84]
    *   [updateLFO][85]
        *   [Parameters][86]
    *   [setContext][87]
        *   [Parameters][88]
    *   [setGlobalContext][89]
        *   [Parameters][90]
    *   [setMuted][91]
        *   [Parameters][92]
    *   [setTranspose][93]
        *   [Parameters][94]
    *   [setName][95]
        *   [Parameters][96]

## DrumPattern

**Extends AbstractPattern**

### Parameters

*   `$0` **[Object][97]**  (optional, default `{}`)

    *   `$0.mediumPattern` &#x20;
    *   `$0.drumMap`   (optional, default `{}`)
    *   `$0.patternLength`   (optional, default `16`)

### \_inferLowAndHighPatterns

Over-simplified heuristic: drop some hits for low, add more hits for high.
You can expand or refine this logic for your own style.

#### Parameters

*   `mediumPattern` &#x20;

### getNotes

Called by the LiveLoop's tick method to get any hits on this step.

#### Parameters

*   `stepIndex` &#x20;
*   `context` &#x20;

### getLength

### setHypeLevel

Let the EnergyManager or user code override the hype level manually.

#### Parameters

*   `level` &#x20;

## SyncopatedBass

**Extends AbstractPattern**

SyncopatedBass pattern that combines a preset step pattern (funk/latin/reggae) with
chordManager for harmonic info and rhythmManager for dynamic velocity/accent logic.

### Parameters

*   `$0` **[Object][97]**  (optional, default `{}`)

    *   `$0.length`   (optional, default `16`)
    *   `$0.octave`   (optional, default `2`)
    *   `$0.probabilities`   (optional, default `{root:60,fifth:30,third:10}`)
    *   `$0.rhythmPreset`   (optional, default `"funk"`)
    *   `$0.probabilityToAdvance`   (optional, default `50`)
    *   `$0.restProbability`   (optional, default `30`)

### getNotes

Returns notes for the given step index, using chordManager for chord info,
and rhythmManager for additional rhythmic logic and velocity shaping.

#### Parameters

*   `stepIndex` **[number][98]**&#x20;
*   `context` **[Object][97]** Typically includes { chordManager, rhythmManager, ... }

### selectNoteByProbability

Helper that selects root, fifth, or third from the chord
based on the configured probability weighting.

#### Parameters

*   `chord` &#x20;

### getLength

Number of steps in one cycle of this pattern.

## ExplicitNotePattern

**Extends AbstractPattern**

### Parameters

*   `notesArray` &#x20;

### getNotes

Returns an array of note objects for the current stepIndex.
May return multiple notes if the pattern has multiple notes for this step.

#### Parameters

*   `stepIndex` **[number][98]** Which step we are on (0-based).
*   `context` **any?** Unused in this pattern, but could be chord info, etc.

### getLength

The total number of steps before repeating.

Returns **[number][98]**&#x20;

## LFO

src/lfo.js

A Low-Frequency Oscillator (LFO) domain object.
It generates a wave value (e.g., sine, triangle) over time, based on frequency, amplitude, etc.
Additionally, it targets a specific parameter for modulation.

Usage:
const lfo = new LFO({ frequency: 1, shape: 'sine', amplitude: 1, offset: 0, phase: 0, targetParam: 'filterCutoff', minCcValue: 30, maxCcValue: 100 });
// Called each "tick" (deltaTime might be in beats or seconds, your choice).
const value = lfo.update(deltaTime);
// Or use absolute time for more accurate high-resolution updates:
const value = lfo.updateContinuousTime(absoluteTimeInBeats);
// value is typically in the range \[-amplitude..+amplitude], shifted by offset, and mapped to a CC value range.

### Parameters

*   `$0` **[Object][97]**  (optional, default `{}`)

    *   `$0.frequency`   (optional, default `1.0`)
    *   `$0.amplitude`   (optional, default `1.0`)
    *   `$0.offset`   (optional, default `0.0`)
    *   `$0.phase`   (optional, default `0.0`)
    *   `$0.shape`   (optional, default `"sine"`)
    *   `$0.useRadians`   (optional, default `true`)
    *   `$0.targetParam`   (optional, default `null`)
    *   `$0.minCcValue`   (optional, default `0`)
    *   `$0.maxCcValue`   (optional, default `127`)

### update

Update the LFO with a given time increment, returning the current wave value.

#### Parameters

*   `deltaTime` **[number][98]** The elapsed time since last update.
    Could be in seconds (if frequency is in Hz) or in beats (if frequency is cycles/beat).

Returns **[number][98]** The LFO output, typically in the range \[-amplitude..+amplitude] + offset, mapped to a CC value range.

### updateContinuousTime

Update the LFO using absolute time value, for more accurate high-resolution updates.
The phase is set based on the absolute time rather than incrementally.

#### Parameters

*   `absoluteTime` **[number][98]** The absolute time in beats or seconds

Returns **[number][98]** The LFO output, typically in the range \[-amplitude..+amplitude] + offset, mapped to a CC value range

### \_computeWaveValue

Helper function to compute the wave value for the current phase
based on the selected shape, and map it to a CC value range if targetParam is set.

#### Parameters

*   `phase` **[number][98]**&#x20;

Returns **[number][98]**&#x20;

### reset

Reset phase to a given value. Default = 0

#### Parameters

*   `phase` **[number][98]** can be 0..2π if useRadians=true, or 0..1 if not (optional, default `0`)

### setFrequency

#### Parameters

*   `freq` &#x20;

### getFrequency

### setAmplitude

#### Parameters

*   `amp` &#x20;

### getAmplitude

### setOffset

#### Parameters

*   `off` &#x20;

### getOffset

### setShape

#### Parameters

*   `shape` &#x20;

### getShape

### setPhase

#### Parameters

*   `p` &#x20;

### getPhase

### setUseRadians

#### Parameters

*   `bool` &#x20;

### getUseRadians

### setTargetParam

#### Parameters

*   `param` &#x20;

### getTargetParam

### setMinCcValue

#### Parameters

*   `value` &#x20;

### getMinCcValue

### setMaxCcValue

#### Parameters

*   `value` &#x20;

### getMaxCcValue

## EnergyManager

src/energy-manager.js

The EnergyManager is an optional high-level orchestrator that adjusts
LiveLoops in real-time to reflect changes in "energy," such as hype or tension.
It does not handle transport or MIDI directly—only manipulates loops' patterns,
LFO parameters, muting/unmuting, etc.

This example assumes:

*   Your LiveLoops have some methods for pattern swapping, muting, and possibly LFO updates.
*   Your Patterns can change voicings, tension, or other qualities if applicable.

Usage:
const chordManager = new ChordManager();
const rhythmManager = new RhythmManager();
const manager = new EnergyManager({
liveLoops: \[drumLoop, bassLoop, melodyLoop],
chordManager,
rhythmManager
});
manager.setHypeLevel("full");   // manipulates loops to "full" arrangement
manager.setTensionLevel("high"); // more dissonant chords, removing fundamental, etc.

### Parameters

*   `$0` **[Object][97]**  (optional, default `{}`)

    *   `$0.liveLoops`   (optional, default `[]`)
    *   `$0.chordManager`   (optional, default `null`)
    *   `$0.rhythmManager`   (optional, default `null`)
    *   `$0.globalContext`   (optional, default `null`)

### setHypeLevel

Sets the hype level (e.g., "low", "medium", "full") across all relevant LiveLoops.
This might involve:

*   Muting/unmuting certain loops
*   Swapping patterns for busier or simpler ones
*   Adjusting LFO frequencies or amplitudes
*   Setting rhythm subdivisions through RhythmManager

#### Parameters

*   `level` **[string][99]** e.g. "low", "medium", "full", or other

### setTensionLevel

Sets the tension level ("none", "mid", "high", etc.). This might involve:

*   Using more dissonant chord patterns through ChordManager
*   Omitting certain chord tones for implied tension
*   Filtration or removing fundamental frequencies to create "missing" tension

#### Parameters

*   `level` **[string][99]** e.g. "none", "low", "mid", "high"

### addLiveLoop

Add or remove a LiveLoop from the manager. Useful if loops are created dynamically.

#### Parameters

*   `loop` &#x20;

### removeLiveLoop

#### Parameters

*   `loop` &#x20;

### setArrangementStyle

(Optional) A method to set arrangement style, or other categories of changes.
For example, "setArrangementStyle('wide')" might force wide chord voicings or bigger reverb, etc.

#### Parameters

*   `style` &#x20;

### setChordProgression

Update the ChordManager to use a new chord progression

#### Parameters

*   `progression` **[Array][100]** Array of chord objects

## LiveLoop

src/live-loop.js

A LiveLoop class that:

*   Holds a Pattern (implements getNotes(stepIndex, context?))
*   Holds zero or more LFOs
*   On each tick, calls pattern.getNotes(...) and sends noteOn to the MIDI Bus
*   Updates each LFO and sends controlChange events for parameter modulation
*   Handles noteOff scheduling for active notes based on their duration
*   Allows immediate or enqueued updates of patterns and LFOs
*   Keeps track of active notes with their expected end steps for noteOff processing

This ensures we never start/stop the transport ourselves,
and the note-off logic is handled internally based on the step index.

Added for Energy / Tension:

*   A 'muted' flag to enable/disable noteOn sending (useful for layering/unlayering).
*   A 'transpose' (or semitone shift) to raise/lower the pitch for hype or tension changes.
*   Both can be changed on the fly by an EnergyManager or other orchestrator.
*   Support for GlobalContext with ChordManager and RhythmManager.

Added for Note Duration Management:

*   An 'activeNotes' array to track currently playing notes
*   Each note stores its endStep, calculated from stepIndex + (noteObj.durationSteps || 1)
*   At each tick, checks for expired notes (stepIndex >= endStep) and sends noteOff
*   Using strictly integer step durations for reliability

### Parameters

*   `midiBus` &#x20;
*   `$1` **[Object][97]**  (optional, default `{}`)

    *   `$1.pattern` &#x20;
    *   `$1.lfos`   (optional, default `[]`)
    *   `$1.midiChannel`   (optional, default `1`)
    *   `$1.context`   (optional, default `{}`)
    *   `$1.globalContext`   (optional, default `null`)
    *   `$1.name`   (optional, default `""`)
    *   `$1.muted`   (optional, default `false`)
    *   `$1.transpose`   (optional, default `0`)
    *   `$1.deviceDefinition`   (optional, default `null`)
    *   `$1.deviceManager`   (optional, default `null`)
    *   `$1.midiOutputId`   (optional, default `null`)

### tick

Called by TransportManager each "tick" or time subdivision.
With the updated TransportManager, this is only called at integer step boundaries.

On each tick, we:

1.  Apply any queued changes if at loop boundary
2.  Get notes from the pattern for this step
3.  Process new notes:
    *   Send noteOn if the loop is not muted
    *   Store the note in activeNotes with calculated endStep
        (endStep = stepIndex + (noteObj.durationStepsOrBeats || 1))
4.  Check activeNotes for expired notes and send noteOff for any where endStep <= stepIndex
5.  Update LFOs and send controlChange events

#### Parameters

*   `stepIndex` **[number][98]** Current step index in the sequence (always an integer)
*   `deltaTime` **[number][98]** Time elapsed since last update in beats
*   `absoluteTime` **([number][98] | null)** Optional absolute time position in beats (optional, default `null`)

### updateLFOsOnly

Called by TransportManager on every pulse for high-resolution LFO updates.
This separates the LFO updates from the note pattern logic.

#### Parameters

*   `deltaTime` **[number][98]** Time elapsed since last update in beats
*   `absoluteTime` **([number][98] | null)** Optional absolute time position in beats (optional, default `null`)

### \_applyQueuedChangesIfNeeded

Applies queued changes (pattern or LFO updates) if stepIndex is at pattern boundary.

#### Parameters

*   `stepIndex` &#x20;

### setPattern

Replace the current pattern either immediately or enqueued for next cycle.

#### Parameters

*   `newPattern` **[object][97]** Must implement getNotes() and getLength()
*   `immediate` **[boolean][101]** If true, replace now; if false, wait until loop boundary (optional, default `false`)

### addLFO

Add an LFO immediately (no need to queue).

#### Parameters

*   `lfo` &#x20;

### updateLFO

Update properties of an existing LFO. If immediate=false,
wait until the next pattern boundary before applying changes.

#### Parameters

*   `index` **[number][98]** which LFO to update
*   `newProps` **[object][97]** e.g. { frequency: 2.0, amplitude: 0.5 }
*   `immediate` **[boolean][101]**  (optional, default `false`)

### setContext

Set or update the local context (e.g. chord info, scale, user data).

#### Parameters

*   `context` **[object][97]** New context to set
*   `immediate` **[boolean][101]** If true, apply immediately; if false, queue for next loop (optional, default `true`)

### setGlobalContext

Set or update the global context.

#### Parameters

*   `globalContext` **[object][97]** New global context to use

### setMuted

Mute or unmute the loop. If muted, tick() won't send noteOn messages.
This is helpful for layering during hype changes.

#### Parameters

*   `bool` **[boolean][101]**&#x20;

### setTranspose

Set the semitone transposition. Positive = shift up, negative = shift down.
Will be applied in the next tick's noteOn calls.

#### Parameters

*   `semitones` **[number][98]**&#x20;

### setName

Set the name of this loop, useful for targeting by EnergyManager.

#### Parameters

*   `name` **[string][99]** The name for this loop

[1]: #drumpattern

[2]: #parameters

[3]: #_inferlowandhighpatterns

[4]: #parameters-1

[5]: #getnotes

[6]: #parameters-2

[7]: #getlength

[8]: #sethypelevel

[9]: #parameters-3

[10]: #syncopatedbass

[11]: #parameters-4

[12]: #getnotes-1

[13]: #parameters-5

[14]: #selectnotebyprobability

[15]: #parameters-6

[16]: #getlength-1

[17]: #explicitnotepattern

[18]: #parameters-7

[19]: #getnotes-2

[20]: #parameters-8

[21]: #getlength-2

[22]: #lfo

[23]: #parameters-9

[24]: #update

[25]: #parameters-10

[26]: #updatecontinuoustime

[27]: #parameters-11

[28]: #_computewavevalue

[29]: #parameters-12

[30]: #reset

[31]: #parameters-13

[32]: #setfrequency

[33]: #parameters-14

[34]: #getfrequency

[35]: #setamplitude

[36]: #parameters-15

[37]: #getamplitude

[38]: #setoffset

[39]: #parameters-16

[40]: #getoffset

[41]: #setshape

[42]: #parameters-17

[43]: #getshape

[44]: #setphase

[45]: #parameters-18

[46]: #getphase

[47]: #setuseradians

[48]: #parameters-19

[49]: #getuseradians

[50]: #settargetparam

[51]: #parameters-20

[52]: #gettargetparam

[53]: #setminccvalue

[54]: #parameters-21

[55]: #getminccvalue

[56]: #setmaxccvalue

[57]: #parameters-22

[58]: #getmaxccvalue

[59]: #energymanager

[60]: #parameters-23

[61]: #sethypelevel-1

[62]: #parameters-24

[63]: #settensionlevel

[64]: #parameters-25

[65]: #addliveloop

[66]: #parameters-26

[67]: #removeliveloop

[68]: #parameters-27

[69]: #setarrangementstyle

[70]: #parameters-28

[71]: #setchordprogression

[72]: #parameters-29

[73]: #liveloop

[74]: #parameters-30

[75]: #tick

[76]: #parameters-31

[77]: #updatelfosonly

[78]: #parameters-32

[79]: #_applyqueuedchangesifneeded

[80]: #parameters-33

[81]: #setpattern

[82]: #parameters-34

[83]: #addlfo

[84]: #parameters-35

[85]: #updatelfo

[86]: #parameters-36

[87]: #setcontext

[88]: #parameters-37

[89]: #setglobalcontext

[90]: #parameters-38

[91]: #setmuted

[92]: #parameters-39

[93]: #settranspose

[94]: #parameters-40

[95]: #setname

[96]: #parameters-41

[97]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[98]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number

[99]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[100]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array

[101]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean
